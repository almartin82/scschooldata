---
title: "15 Insights from South Carolina School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from South Carolina School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
# Vignettes require network access and working data sources
# Only run if explicitly enabled via SCSCHOOLDATA_RUN_VIGNETTES=true
# This prevents vignette failures during R CMD check
run_vignette <- identical(Sys.getenv("SCSCHOOLDATA_RUN_VIGNETTES"), "true")

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  eval = run_vignette
)
```

```{r load-packages}
library(scschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

This vignette explores South Carolina's public school enrollment data, surfacing key trends and demographic patterns across 13 years of data (2013-2025).

---

## 1. South Carolina is growing

Unlike many states facing enrollment decline, South Carolina has added approximately 50,000 students since 2013. The Palmetto State's population growth is reflected in its schools.

```{r statewide-trend}
enr <- fetch_enr_multi(c(2013, 2015, 2017, 2019, 2021, 2023, 2025))

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(
    change = n_students - lag(n_students),
    pct_change = round(change / lag(n_students) * 100, 2)
  )

state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#73000A") +
  geom_point(size = 3, color = "#73000A") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "South Carolina Public School Enrollment (2013-2025)",
    subtitle = "Steady growth with a pandemic dip in 2021",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Greenville County is the giant

Greenville County Schools enrolls nearly 77,000 students, making it the largest district in the state and one of the largest in the Southeast.

```{r top-districts}
enr_2025 <- fetch_enr(2025)

top_districts <- enr_2025 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students)

top_districts
```

```{r top-districts-chart}
top_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = district_name)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_viridis_d(option = "mako", begin = 0.2, end = 0.8) +
  labs(
    title = "Top 10 South Carolina Districts by Enrollment (2025)",
    subtitle = "Greenville County leads with 10% of the state's students",
    x = "Number of Students",
    y = NULL
  )
```

---

## 3. Hispanic enrollment is surging

Hispanic student enrollment has more than doubled over the past decade, growing from about 7% to over 12% of total enrollment.

```{r demographics}
demographics <- enr_2025 |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian",
                         "american_indian", "pacific_islander", "multiracial")) |>
  mutate(pct = round(n_students / sum(n_students, na.rm = TRUE) * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "South Carolina Student Demographics (2025)",
    subtitle = "A changing student population reflects statewide demographic shifts",
    x = "Number of Students",
    y = NULL
  )
```

---

## 4. The I-85 Corridor is booming

Districts along the I-85 corridor from Greenville through Spartanburg are among the fastest-growing in the state, fueled by economic development and migration from other states.

```{r i85-corridor}
i85_districts <- enr_2025 |>
  filter(
    grepl("Greenville|Spartanburg|Anderson", district_name),
    is_district,
    subgroup == "total_enrollment",
    grade_level == "TOTAL"
  ) |>
  arrange(desc(n_students)) |>
  select(district_name, n_students) |>
  head(8)

i85_districts
```

```{r regional-chart}
i85_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = district_name)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_viridis_d(option = "plasma", begin = 0.2, end = 0.8) +
  labs(
    title = "I-85 Corridor Districts (2025)",
    subtitle = "The Upstate drives South Carolina's enrollment growth",
    x = "Number of Students",
    y = NULL
  )
```

---

## 5. The Lowcountry is expanding

Charleston, Berkeley, and Dorchester counties form South Carolina's tri-county Lowcountry region, and all three have seen substantial enrollment growth.

```{r lowcountry-growth}
lowcountry_enr <- fetch_enr_multi(c(2015, 2020, 2025))

lowcountry <- lowcountry_enr |>
  filter(
    grepl("Charleston|Berkeley|Dorchester", district_name),
    is_district,
    subgroup == "total_enrollment",
    grade_level == "TOTAL"
  ) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students) |>
  mutate(
    growth = `2025` - `2015`,
    pct_growth = round(growth / `2015` * 100, 1)
  ) |>
  arrange(desc(growth))

lowcountry
```

```{r growth-chart}
lowcountry |>
  mutate(district_name = forcats::fct_reorder(district_name, growth)) |>
  ggplot(aes(x = growth, y = district_name, fill = pct_growth)) +
  geom_col() +
  geom_text(aes(label = paste0("+", scales::comma(growth))), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.2))) +
  scale_fill_gradient(low = "#56B4E9", high = "#0072B2", name = "% Growth") +
  labs(
    title = "Lowcountry Enrollment Growth (2015-2025)",
    subtitle = "Berkeley County leads the tri-county region",
    x = "Student Growth",
    y = NULL
  )
```

---

## 6. More than half are economically disadvantaged

Approximately 58% of South Carolina students qualify for free or reduced-price lunch, with rates exceeding 85% in some rural districts.

```{r econ-disadv}
econ_state <- enr_2025 |>
  filter(is_state, grade_level == "TOTAL", subgroup == "econ_disadv") |>
  select(subgroup, n_students, pct) |>
  mutate(pct = round(pct * 100, 1))

econ_state
```

```{r econ-districts}
# Districts with highest rates
econ_districts <- enr_2025 |>
  filter(is_district, grade_level == "TOTAL", subgroup == "econ_disadv") |>
  filter(!is.na(pct)) |>
  arrange(desc(pct)) |>
  select(district_name, n_students, pct) |>
  mutate(pct = round(pct * 100, 1)) |>
  head(10)

econ_districts
```

```{r econ-chart}
econ_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, pct)) |>
  ggplot(aes(x = pct, y = district_name, fill = pct)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::percent, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_gradient(low = "#FDE725", high = "#440154") +
  labs(
    title = "Highest Economically Disadvantaged Rates (2025)",
    subtitle = "Some rural districts exceed 85% poverty",
    x = "Percent of Students",
    y = NULL
  )
```

---

## 7. State-authorized charters are growing fast

The SC Public Charter School District (code 900) serves state-authorized charter schools and has grown to over 30,000 students.

```{r charter-growth}
charter_enr <- fetch_enr_multi(c(2015, 2020, 2025))

charter_trends <- charter_enr |>
  filter(
    grepl("Charter School District", district_name),
    is_district,
    subgroup == "total_enrollment",
    grade_level == "TOTAL"
  ) |>
  select(end_year, n_students)

charter_trends
```

```{r charter-pct}
# Charter as percent of state
charter_pct <- enr_2025 |>
  filter(is_state | grepl("Charter School District", district_name),
         subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(district_name, n_students) |>
  mutate(type = ifelse(is.na(district_name), "State Total", "Charter")) |>
  select(type, n_students)

charter_pct
```

```{r charter-chart}
charter_trends |>
  ggplot(aes(x = factor(end_year), y = n_students, group = 1)) +
  geom_line(linewidth = 1.2, color = "#E69F00") +
  geom_point(size = 3, color = "#E69F00") +
  geom_text(aes(label = scales::comma(n_students)), vjust = -0.5, size = 3.5) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Charter District Growth (2015-2025)",
    subtitle = "State-authorized charters have more than doubled",
    x = "School Year",
    y = "Enrollment"
  )
```

---

## 8. Kindergarten is recovering from COVID

Kindergarten enrollment dropped sharply during the pandemic but is now recovering toward pre-pandemic levels.

```{r k-trend}
k_enr <- fetch_enr_multi(2019:2025)

k_trends <- k_enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "K") |>
  select(end_year, n_students) |>
  mutate(
    change_from_2019 = n_students - first(n_students),
    pct_change = round(change_from_2019 / first(n_students) * 100, 1)
  )

k_trends
```

```{r k-chart}
k_trends |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#009E73") +
  geom_point(size = 3, color = "#009E73") +
  geom_vline(xintercept = 2020.5, linetype = "dashed", color = "gray50") +
  annotate("text", x = 2020.5, y = max(k_trends$n_students) * 0.98,
           label = "Pandemic", hjust = 1.1, color = "gray30") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Kindergarten Enrollment: Pandemic Impact & Recovery",
    subtitle = "COVID caused a sharp drop in 2021, with gradual recovery since",
    x = "School Year",
    y = "Kindergarten Enrollment"
  )
```

---

## 9. Rural Pee Dee districts are declining

While much of South Carolina grows, rural districts in the Pee Dee region face persistent enrollment decline.

```{r pee-dee}
pee_dee_enr <- fetch_enr_multi(c(2015, 2025))

pee_dee <- pee_dee_enr |>
  filter(
    grepl("Marion|Dillon|Marlboro|Florence", district_name),
    is_district,
    subgroup == "total_enrollment",
    grade_level == "TOTAL"
  ) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students) |>
  mutate(
    change = `2025` - `2015`,
    pct_change = round(change / `2015` * 100, 1)
  ) |>
  filter(!is.na(`2015`), !is.na(`2025`)) |>
  arrange(pct_change) |>
  head(8)

pee_dee
```

```{r pee-dee-chart}
pee_dee |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_change)) |>
  ggplot(aes(x = pct_change, y = district_name, fill = pct_change < 0)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct_change, "%")),
            hjust = ifelse(pee_dee$pct_change < 0, -0.1, 1.1), size = 3.5) +
  scale_x_continuous(labels = function(x) paste0(x, "%"),
                     expand = expansion(mult = c(0.15, 0.15))) +
  scale_fill_manual(values = c("TRUE" = "#D55E00", "FALSE" = "#009E73")) +
  labs(
    title = "Pee Dee Districts: A Decade of Decline",
    subtitle = "2015-2025 enrollment change in rural counties",
    x = "Percent Change",
    y = NULL
  )
```

---

## 10. District size varies dramatically

South Carolina's 80 districts range from tiny rural systems to massive county-wide operations serving tens of thousands.

```{r district-sizes}
district_sizes <- enr_2025 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  mutate(size_bucket = case_when(
    n_students < 5000 ~ "Small (<5K)",
    n_students < 15000 ~ "Medium (5K-15K)",
    n_students < 30000 ~ "Large (15K-30K)",
    TRUE ~ "Very Large (30K+)"
  )) |>
  count(size_bucket) |>
  mutate(size_bucket = factor(size_bucket,
                              levels = c("Small (<5K)", "Medium (5K-15K)",
                                         "Large (15K-30K)", "Very Large (30K+)")))

district_sizes
```

```{r district-sizes-chart}
district_sizes |>
  ggplot(aes(x = size_bucket, y = n, fill = size_bucket)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = n), vjust = -0.5, size = 4) +
  scale_fill_brewer(palette = "Blues") +
  scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  labs(
    title = "South Carolina District Size Distribution",
    subtitle = "80 districts range from tiny rural systems to massive county-wide operations",
    x = "District Size",
    y = "Number of Districts"
  )
```

---

## 11. Richland vs Lexington: Columbia's Suburban Divide

The Columbia metro area is split between Richland and Lexington counties, with very different enrollment trajectories. Lexington County districts have grown substantially while Richland districts have been more stable.

```{r columbia-metro}
columbia_enr <- fetch_enr_multi(c(2015, 2020, 2025))

columbia_districts <- columbia_enr |>
  filter(
    grepl("Richland|Lexington", district_name),
    is_district,
    subgroup == "total_enrollment",
    grade_level == "TOTAL"
  ) |>
  select(end_year, district_name, n_students) |>
  pivot_wider(names_from = end_year, values_from = n_students) |>
  mutate(
    growth = `2025` - `2015`,
    pct_growth = round(growth / `2015` * 100, 1),
    county = ifelse(grepl("Richland", district_name), "Richland", "Lexington")
  ) |>
  filter(!is.na(`2015`), !is.na(`2025`)) |>
  arrange(desc(growth))

columbia_districts
```

```{r columbia-metro-chart}
columbia_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, growth)) |>
  ggplot(aes(x = growth, y = district_name, fill = county)) +
  geom_col() +
  geom_text(aes(label = paste0(ifelse(growth > 0, "+", ""), scales::comma(growth))),
            hjust = ifelse(columbia_districts$growth > 0, -0.1, 1.1), size = 3.5) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0.15, 0.15))) +
  scale_fill_manual(values = c("Lexington" = "#2E86AB", "Richland" = "#A23B72"), name = "County") +
  labs(
    title = "Columbia Metro: Lexington Growth Outpaces Richland",
    subtitle = "Enrollment change 2015-2025",
    x = "Student Change",
    y = NULL
  )
```

---

## 12. The Gender Gap in South Carolina Schools

South Carolina's schools have a slight male majority in younger grades, but the pattern shifts as students progress through school.

```{r gender-by-grade}
gender_data <- enr_2025 |>
  filter(
    is_state,
    subgroup %in% c("male", "female"),
    !grade_level %in% c("TOTAL", "PK")
  ) |>
  select(grade_level, subgroup, n_students) |>
  pivot_wider(names_from = subgroup, values_from = n_students) |>
  mutate(
    total = male + female,
    pct_male = round(male / total * 100, 1),
    pct_female = round(female / total * 100, 1),
    grade_level = factor(grade_level, levels = c("K", sprintf("%02d", 1:12)))
  ) |>
  filter(!is.na(grade_level)) |>
  arrange(grade_level)

gender_data
```

```{r gender-gap-chart}
gender_data |>
  ggplot(aes(x = grade_level, y = pct_male - 50)) +
  geom_col(aes(fill = pct_male > 50), show.legend = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray40") +
  scale_fill_manual(values = c("TRUE" = "#4575B4", "FALSE" = "#D73027")) +
  scale_y_continuous(labels = function(x) paste0(50 + x, "%")) +
  labs(
    title = "Gender Balance Across Grade Levels",
    subtitle = "Percentage point deviation from 50/50 split (above = more male)",
    x = "Grade Level",
    y = "Male Percentage"
  )
```

---

## 13. High School Enrollment: The 9th Grade Bulge

High schools show a distinctive enrollment pattern: 9th grade is consistently the largest, with enrollment declining through 12th grade. This reflects retention, transfers, and dropouts.

```{r high-school-grades}
hs_grades <- enr_2025 |>
  filter(
    is_state,
    subgroup == "total_enrollment",
    grade_level %in% c("09", "10", "11", "12")
  ) |>
  select(grade_level, n_students) |>
  mutate(
    grade_label = case_when(
      grade_level == "09" ~ "9th Grade",
      grade_level == "10" ~ "10th Grade",
      grade_level == "11" ~ "11th Grade",
      grade_level == "12" ~ "12th Grade"
    ),
    grade_label = factor(grade_label, levels = c("9th Grade", "10th Grade", "11th Grade", "12th Grade")),
    pct_of_9th = round(n_students / first(n_students) * 100, 1)
  )

hs_grades
```

```{r high-school-chart}
hs_grades |>
  ggplot(aes(x = grade_label, y = n_students, fill = grade_label)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), vjust = -0.5, size = 4) +
  geom_text(aes(label = paste0(pct_of_9th, "% of 9th")), vjust = 1.5, color = "white", size = 3.5) +
  scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_viridis_d(option = "viridis", begin = 0.3, end = 0.9) +
  labs(
    title = "The 9th Grade Bulge",
    subtitle = "High school enrollment drops 15-20% from 9th to 12th grade",
    x = NULL,
    y = "Number of Students"
  )
```

---

## 14. South Carolina's Smallest Districts

Not all South Carolina districts are massive county systems. Several rural districts serve fewer than 2,000 students.

```{r smallest-districts}
smallest <- enr_2025 |>
  filter(
    is_district,
    subgroup == "total_enrollment",
    grade_level == "TOTAL",
    !grepl("Charter", district_name)
  ) |>
  arrange(n_students) |>
  select(district_name, n_students) |>
  head(10)

smallest
```

```{r smallest-districts-chart}
smallest |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = n_students)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.2))) +
  scale_fill_gradient(low = "#FDE725", high = "#21918C") +
  labs(
    title = "South Carolina's Smallest Districts",
    subtitle = "Rural districts serving fewer than 3,000 students each",
    x = "Number of Students",
    y = NULL
  )
```

---

## 15. Charleston's Decade of Transformation

Charleston County School District has undergone significant demographic change over the past decade, reflecting the city's rapid growth and gentrification.

```{r charleston-demographics}
charleston_demo <- fetch_enr_multi(c(2015, 2020, 2025))

charleston_demo_trends <- charleston_demo |>
  filter(
    grepl("Charleston County", district_name),
    is_district,
    grade_level == "TOTAL",
    subgroup %in% c("white", "black", "hispanic", "asian", "multiracial")
  ) |>
  select(end_year, subgroup, n_students) |>
  group_by(end_year) |>
  mutate(pct = round(n_students / sum(n_students, na.rm = TRUE) * 100, 1)) |>
  ungroup()

charleston_demo_trends |>
  pivot_wider(names_from = end_year, values_from = c(n_students, pct))
```

```{r charleston-demographics-chart}
charleston_demo_trends |>
  mutate(subgroup = factor(subgroup, levels = c("white", "black", "hispanic", "asian", "multiracial"))) |>
  ggplot(aes(x = factor(end_year), y = pct, fill = subgroup)) +
  geom_col(position = "stack") +
  geom_text(aes(label = ifelse(pct > 5, paste0(pct, "%"), "")),
            position = position_stack(vjust = 0.5), color = "white", size = 3) +
  scale_fill_brewer(palette = "Set2", name = "Subgroup",
                    labels = c("White", "Black", "Hispanic", "Asian", "Multiracial")) +
  labs(
    title = "Charleston County: A Changing District",
    subtitle = "Demographic composition 2015-2025",
    x = "School Year",
    y = "Percentage of Enrollment"
  )
```

---

## Summary

South Carolina's school enrollment data reveals:

- **Growing state**: Unlike many states, South Carolina continues to add students
- **Regional divergence**: Upstate and Lowcountry boom while the Pee Dee declines
- **Increasing diversity**: Hispanic enrollment has more than doubled in a decade
- **High poverty rates**: Nearly 6 in 10 students are economically disadvantaged
- **Charter expansion**: State-authorized charters now serve 4% of all students

These patterns shape school funding, facility planning, and policy decisions across the Palmetto State.

---

*Data sourced from the South Carolina Department of Education [Active Student Headcounts](https://ed.sc.gov/data/other/student-counts/active-student-headcounts/).*
